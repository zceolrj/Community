var elife=angular.module("elife",["ngRoute","ngCookies","mobile-angular-ui","mobile-angular-ui.core.fastclick","at.multirange-slider","angular-carousel","mobile-angular-ui.core.outerClick"]).factory("_serarchCity",["$http","$timeout","$cookieStore",function(a,b,c){return console.log("cached"),a({method:"post",url:"http://192.168.2.60:8080/OFSTCUST/area/search.action",data:{t_k:c.get("t_k"),c_no:c.get("c_no"),country_code:"CN",keyword:""},cache:!0})}]).factory("_CONFIG_",["$http","$cookieStore",function(a,b){var c=window.navigator.userAgent,d=function(){return/(iPhone|iPod|iPad|iOS)/i.test(c)?"ios":/Android/i.test(c)?"android":"other"}(),e=b.get("t_k"),f="AA",g={os:d,t_k:e,c_no:f,remoteHost:"http://192.168.2.60:8080"};return g}]).factory("_doLogin",["$http","$cookieStore",function(a,b){var c="http://192.168.2.60:8080/OFSTCUST/cuinfo/login.action",d={userId:"100001",c_no:"AA"};return a({method:"POST",url:c,data:d})}]).config(["$routeProvider",function(a){a.when("/home/index",{templateUrl:"views/home/index.html",controller:"IndexCtrl"}).when("/home/search",{templateUrl:"views/home/search.html",controller:"IndexSearchCtrl"}).when("/discount/search",{templateUrl:"views/discount/search.html",controller:"DiscountSearchCtrl"}).when("/discount/search_result",{templateUrl:"views/discount/offer_search_result.html",controller:"OfferSearchResultCtrl"}).when("/home/search_result/:keyword",{templateUrl:"views/home/business_search_result.html",controller:"BusinessSearchResultCtrl"}).when("/home/search_no_result",{templateUrl:"views/home/business_no_result.html",controller:"BusinessSearchResultCtrl"}).when("/discount/index",{templateUrl:"views/discount/index.html",controller:"IndexDiscountCtrl"}).when("/locator",{templateUrl:"views/home/locator.html",controller:"LocatorCtrl"}).when("/choose_locator",{templateUrl:"views/home/choose_locator.html",controller:"LocatorCtrl"}).when("/business/index/:id",{templateUrl:"views/home/business_info.html",controller:"BusinessInfoCtrl"}).when("/business/recommend",{templateUrl:"views/home/business_recommend.html",controller:"businessRecommendCtrl"}).when("/business/special_offer",{templateUrl:"views/home/special_offer.html",controller:"specialOfferCtrl"}).when("/discount/card_offer",{templateUrl:"views/discount/card_offer_info.html",controller:"IndexDiscountCtrl"}).when("/discount/bank_offer",{templateUrl:"views/discount/bank_offer_info.html",controller:"IndexDiscountCtrl"}).when("/discount/card_list",{templateUrl:"views/discount/card_offer_list.html",controller:"CardOfferListCtrl"}).when("/discount/business_offer",{templateUrl:"views/discount/business_offer_info.html",controller:"IndexDiscountCtrl"}).when("/discount/search_result",{templateUrl:"views/discount/offer_search_result.html",controller:"OfferSearchResultCtrl"}).when("/business/other_store",{templateUrl:"views/home/other_store.html",controller:"BusinessInfoCtrl"}).when("/business/available_store",{templateUrl:"views/home/available_store.html",controller:"BusinessInfoCtrl"}).when("/business_district",{templateUrl:"views/home/business_district.html",controller:"BusinessDistrictInfoCtrl"}).when("/error/other/:id",{templateUrl:"views/error/other_error.html",controller:"ErrorCtrl"}).when("/review/album",{templateUrl:"views/home/review_album.html",controller:"ReviewAlbumCtrl"}).when("/review/album_noup",{templateUrl:"views/home/review_album_noupload.html",controller:"ReviewAlbumCtrl"}).when("/business/album",{templateUrl:"views/home/business_album.html",controller:"ReviewAlbumCtrl"}).when("/error/business/:id",{templateUrl:"views/error/business_error.html",controller:"ErrorCtrl"}).when("/error/district/:id",{templateUrl:"views/error/district_error.html",controller:"ErrorCtrl"}).when("/business/detail/:id",{templateUrl:"views/home/business_detail.html",controller:"BusinessDetailCtrl"}).when("/review/index",{templateUrl:"views/home/review_index.html",controller:"ReviewIndexCtrl"}).when("/review/photo_added",{templateUrl:"views/home/review_photo_added.html",controller:"PhotoAddedCtrl"}).when("/review/photo_edit",{templateUrl:"views/home/review_photo_edit.html",controller:"PhotoEditCtrl"}).when("/review/comment",{templateUrl:"views/home/review_comment.html",controller:"ReviewCommentCtrl"}).when("/review/comment_personal",{templateUrl:"views/home/review_comment_personal.html",controller:"ReviewCommentCtrl"}).when("/discount/comment",{templateUrl:"views/home/review_comment.html",controller:"DiscountCommentCtrl"}).when("/home/yidai_business/:name",{templateUrl:"views/home/yidai_business.html",controller:"YidaiBusinessCtrl"}).when("/home/category/:id/:name",{templateUrl:"views/home/food.html",controller:"CategoryResultCtrl"}).when("/home/food",{templateUrl:"views/home/food_selected.html",controller:"CategoryResultCtrl"}).when("/discount/discount_food",{templateUrl:"views/discount/discount_food.html",controller:"OfferSearchResultCtrl"}).when("/home/categories",{templateUrl:"views/home/categories.html",controller:"HomeCategoriesCtrl"}).when("/discount/categories",{templateUrl:"views/home/categories.html",controller:"DiscountCategoriesCtrl"}).when("/discount/customers",{templateUrl:"views/discount/customers_info.html",controller:"CustomersInfoCtrl"}).when("/discount/customers_more",{templateUrl:"views/discount/customers_more_info.html",controller:"CustomersInfoCtrl"}).when("/discount/customers_add_order",{templateUrl:"views/discount/customers_add_order.html",controller:"CustomersInfoCtrl"}).when("/discount/customers_succeeded",{templateUrl:"views/discount/customers_succeeded.html",controller:"CustomersInfoCtrl"}).when("/district_list",{templateUrl:"views/error/district_list.html",controller:"DistrictListCtrl"}).when("/test",{templateUrl:"views/home/test.html",controller:"TestCtrl"}).when("/personal/index",{templateUrl:"views/personal/personal.html",controller:"PersonalCtrl"}).when("/personal/my_favorites",{templateUrl:"views/personal/my_favorites.html",controller:"MyFavoritesCtrl"}).when("/personal/my_customers",{templateUrl:"views/personal/my_customers.html",controller:"MyCustomersCtrl"}).when("/personal/send_customers",{templateUrl:"views/personal/send_customers.html",controller:"MyCustomersCtrl"}).when("/personal/my_comment",{templateUrl:"views/personal/my_comment.html",controller:"MyCommentCtrl"}).when("/personal/my_comment/:id",{templateUrl:"views/personal/my_comment_detail.html",controller:"MyCommentDetailCtrl"}).when("/personal/customers_drawback",{templateUrl:"views/personal/customers_drawback.html",controller:"MyCustomersCtrl"}).when("/personal/customers_drawback_info",{templateUrl:"views/personal/customers_drawback_info.html",controller:"MyCustomersCtrl"}).when("/personal/my_customers_info",{templateUrl:"views/personal/my_customers_info.html",controller:"MyCustomersCtrl"}).when("/personal/my_customers_info_drawback",{templateUrl:"views/personal/my_customers_info_drawback.html",controller:"MyCustomersCtrl"}).when("/personal/my_customers_info_unpaid",{templateUrl:"views/personal/my_customers_info_unpaid.html",controller:"MyCustomersCtrl"}).when("/personal/e_coupon",{templateUrl:"views/personal/e_coupon.html",controller:"ECouponCtrl"}).when("/personal/e_coupon_intro",{templateUrl:"views/personal/e_coupon_intro.html",controller:"ECouponCtrl"}).when("/personal/e_coupon_blank",{templateUrl:"views/personal/e_coupon_blank.html",controller:"ECouponCtrl"}).when("/personal/e_coupon_business_list",{templateUrl:"views/personal/e_coupon_business_list.html",controller:"ECouponCtrl"}).when("/personal/e_coupon_business_blank",{templateUrl:"views/personal/e_coupon_business_blank.html",controller:"ECouponCtrl"}).when("/personal/personal_info",{templateUrl:"views/personal/personal_info.html",controller:"PersonalInfoCtrl"}).when("/personal/personal_change_nickname",{templateUrl:"views/personal/personal_change_nickname.html",controller:"PersonalInfoCtrl"}).when("/personal/personal_change_nickname",{templateUrl:"views/personal/personal_change_nickname.html",controller:"PersonalInfoCtrl"}).when("/personal/personal_change_nickname",{templateUrl:"views/personal/personal_change_nickname.html",controller:"PersonalInfoCtrl"}).when("/personal/personal_change_tel",{templateUrl:"views/personal/personal_change_tel.html",controller:"PersonalInfoCtrl"}).when("/personal/personal_change_passwd",{templateUrl:"views/personal/personal_change_passwd.html",controller:"PersonalInfoCtrl"}).when("/personal/trade",{templateUrl:"views/personal/trade_list.html"}).when("/personal/trade_detail",{templateUrl:"views/personal/trade_detail.html"}).when("/personal/trade_returns",{templateUrl:"views/personal/trade_returns.html",controller:"PersonalCtrl"}).when("/more/index",{templateUrl:"views/more/index.html",controller:"PersonalCtrl"}).when("/more/feedback",{templateUrl:"views/more/feedback.html",controller:"PersonalCtrl"}).when("/more/help",{templateUrl:"views/more/help.html",controller:"PersonalCtrl"}).when("/error/district_list",{templateUrl:"views/error/district_list.html",controller:"DistrictListCtrl"}).when("/error/categories",{templateUrl:"views/error/categories.html",controller:"HomeCategoriesCtrl"}).when("/personal/orders",{templateUrl:"views/personal/orders.html"}).when("/personal/app_orders",{templateUrl:"views/personal/app_orders.html"}).when("/personal/ewm_orders",{templateUrl:"views/personal/ewm_orders.html"}).when("/personal/pay_orders",{templateUrl:"views/personal/pay_orders.html"}).when("/home/jifen_business/:name",{templateUrl:"views/home/jifen_business.html",controller:"JifenBusinessCtrl"})}]).config(["$httpProvider",function(a){a.defaults.headers.put["Content-Type"]="application/x-www-form-urlencoded",a.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded",a.defaults.transformRequest=[function(a){var b=function(a){var c,d,e,f,g,h,i,j="";for(c in a)if(d=a[c],d instanceof Array)for(i=0;i<d.length;++i)g=d[i],e=c+"["+i+"]",h={},h[e]=g,j+=b(h)+"&";else if(d instanceof Object)for(f in d)g=d[f],e=c+"["+f+"]",h={},h[e]=g,j+=b(h)+"&";else void 0!==d&&null!==d&&(j+=encodeURIComponent(c)+"="+encodeURIComponent(d)+"&");return j.length?j.substr(0,j.length-1):j};return angular.isObject(a)&&"[object File]"!==String(a)?b(a):a}]}]).controller("MainController",["$rootScope","$scope","$timeout",function(a,b,c){a.$on("$routeChangeStart",function(){a.loading=!0}),a.$on("$routeChangeSuccess",function(){a.loading=!1}),a.toast=function(a,d){d=d||3e3,b.toastShow=!0,b.toastContent=a,this._timer&&c.cancel(this._timer),this._timer=c(function(){b.toastShow=!1},d)},b.toastShow=!1,b.toastContent=""}]).directive("pageTitle",[function(){return{restrict:"A",compile:function(a,b){var c=b.pageTitle;return function(a,b){document.title=c}}}}]);elife.factory("API",["$rootScope","$http","$q","$cookieStore",function(a,b,c,d){function e(a,d,e,f){f=f||!0;var g=c.defer();return b({method:d,url:a,data:e,cache:!0}).success(function(a,b){a&&a.res&&("0"==a.res?g.resolve(a.data||a):g.reject(a.res,a))}).error(function(a,b){g.reject(b,"network failed")}),g.promise}function f(a,d,e,f){f=f||!0;var g=c.defer();return b({method:d,url:a,data:e,cache:!0}).success(function(a,b){a&&a.res&&("0"==a.res?g.resolve(a):g.reject(a.res,a))}).error(function(a,b){g.reject(b,"network failed")}),g.promise}var g,h="http://223.223.177.32:8082",i={baseUrl:h};a.baseUrl=h;var j=c.defer();!function(){var a=window.navigator.userAgent,b=function(){return/(iPhone|iPod|iPad|iOS)/i.test(a)?"ios":/Android/i.test(a)?"android":"other"}(),c=d.get("t_k"),f="AA";i.elifeConf={os:b,t_k:c,c_no:f,remoteHost:h};var k=e(h+"/OFSTCUST/cuinfo/login.action","post",{userId:"100001",c_no:"AA"});k.then(function(a){console.log(a),g=a.t_k,d.get("city_code")&&d.get("city_name")||(d.put("city_code","110100"),d.put("city_name","北京")),d.put("t_k",a.t_k),d.put("c_no","AA"),d.put("cn_code","CN"),d.put("country_code","CN"),d.put("longitude","106.66566666"),d.put("latitude","39.6656666"),j.resolve()},function(a){console.info("login failed with code:"+a),j.resolve()})}();var k={put:function(a,b){var c=JSON.stringify(b);localStorage.setItem(a,c)},get:function(a){var b=localStorage.getItem(a);return JSON.parse(b)}};return i.onLoginReady=function(){return j.promise()},i.isLogin=function(){return!!g},i.getUserInfo=function(){var a={t_k:d.get("t_k"),c_no:d.get("c_no")},b=e(h+"/OFSTCUST/cuinfo/findCuMoreById.action","post",a);return b},i.getBannerInfo=function(){var a={city_code:d.get("city_code"),count:3},b=e(h+"/OFSTCUST/banner/bannerInfo.action","post",a);return b},i.getHomeLargeCategory=function(a){a.city_code=a.city_code||d.get("city_code");var b=e(h+"/OFSTCUST/industry/findBtn.action","post",a);return b},i.getHomeGhService=function(a){a.city_code=a.city_code||110100;var b=e(h+"/OFSTCUST/storecredit/getStoreCreditList.action","post",a);return b},i.getHomeSpecialOffer=function(a){var b=e(h+"/OFSTCUST/industry/findBtn.action","post",a);return b},i.getHomeSearchHistory=function(){var a="HOME_SEARCH_HISTORY";return k.get(a)},i.addHomeSearchHistory=function(a){var b="HOME_SEARCH_HISTORY",c=k.get(b),d=c.indexOf(a);-1!=d?(c.splice(d,1),c.unshift(a)):c.unshift(a),k.put(b,c)},i.clearHomeSearchHistroy=function(){var a="HOME_SEARCH_HISTORY";return k.put(a,[])},i.getHotSearchCity=function(a){a.t_k=d.get("t_k"),a.c_no=d.get("c_no"),a.country_code=a.country_code||"CN",a.top_count=a.top_count||"6";var b=e(h+"/OFSTCUST/area/hotCity.action","post",a);return b},i.getMoreSpecialOffer=function(a){var b=e(h+"/OFSTCUST/industry/findBtn.action","post",a);return b},i.getHomeRecommandStore=function(a){a.t_k=d.get("t_k"),a.c_no=d.get("c_no"),a.count=2,a.city_code=d.get("city_code");var b=e(h+"/OFSTCUST/storecredit/getRecommendedStore.action","post",a);return b},i.getMoreRecommandStore=function(a){var b=e(h+"/OFSTCUST/storecredit/getRecommendedStore.action","post",a);return b},i.getHomeGuessLike=function(a){var b=e(h+"/OFSTCUST/industry/findBtn.action","post",a);return b},i.getAllDistrict=function(a){a.city_code=a.city_code||110100,a.Cn_code=d.get("cn_code"),a.t_k=d.get("t_k"),a.c_no=d.get("c_no");var b=f(h+"/OFSTCUST/businessdistrict/listDistrict.action","post",a);return b},i.getNearBySearch=function(a){a.city_code=a.city_code||110100;var b=e(h+"/OFSTCUST/storedetail/getFoodHome.action","post",a);return b},i.getAllType=function(a){var b=e(h+"/OFSTCUST/industry/getAllType.action","post",a);return b},i.getYidaiBySearch=function(a){a.city_code=a.city_code||110100;var b=e(h+"/OFSTCUST/storeisyd/getStoreIsydList.action","post",a);return b},i.getCardOfferBySearch=function(a){a.city_code=a.city_code||110100;var b=e(h+"/OFSTCUST/storeisyd/?","post",a);return b},i.getCity=function(a){a.t_k=d.get("t_k"),a.c_no=d.get("c_no"),a.country_code=a.country_code||"CN";var b=e(h+"/OFSTCUST/area/showAlphaCity.action","post",a);return b},i.getJifenBySearch=function(a){a.city_code=a.city_code||110100;var b=e(h+"/OFSTCUST/storeisyd/getStoreIsydList.action","post",a);return b},i.getStore=function(a){a.city_code=a.city_code||110100;var b=e(h+"/OFSTCUST/storequery/list.action","post",a);return b},i.resolveDiscountRole=function(a){for(var b=new Array(3),c=new Array("yi","shan","ji","fen","gong","tuan","shua","cu","yu"),d=0,e=0;e<c.length;e++){if(d>2)return b;"1"==a.charAt(e)&&(b[e]=" icon_"+c[e],d++)}return b},i.changePersonalInfo=function(a){var b=e(h+"/OFSTCUST/cuinfo/updateCuinfo.action","post",a);return b},i}]),elife.controller("DistrictListCtrl",["$scope","$rootScope",function(a,b){a.setErrorDistrict=function(a,c){b.district_code=a,b.district_name=c,history.back()}}]),elife.controller("BusinessDetailCtrl",["$scope","$http","$cookieStore","$routeParams","SharedState",function(a,b,c,d,e){a.id=d.id,a.getBusiDetail=function(d){b.post("http://223.223.177.38:8082/OFSTCUST/cuinfo/findCuMoreById.action",{t_k:c.get("t_k"),c_no:c.get("c_no"),store_code:a.id}).success(function(b){data={res:"0",data:{store_code:"102030411111",store_info:"商户简介信息.......",store_ts:"商户特色......",start_time:"07:00",end_time:"23:00"}};var c=data.data;console.log(c),a.busiDetail=c})},a.getBusiDetail(a.id)}]),elife.controller("BusinessDistrictInfoCtrl",["$scope","$http","$cookieStore",function(a,b,c){a.showItem0=!1,a.showItem1=!1,a.subDistrictArray="",b.post("http://223.223.177.38:8082/OFSTCUST/businessdistrict/listDistrict.action",{t_k:c.get("t_k"),c_no:c.get("c_no"),Cn_code:c.get("cn_code"),city_code:c.get("city_code")}).success(function(b){console.log(b),console.log(c.get("cn_code")),console.log(c.get("city_name")),"0"==b.res&&(a.districtInfo=b.data,console.log(a.districtInfo),a.topDistrict=b.top_list)})}]),elife.controller("BusinessInfoCtrl",["$scope","$http","$cookieStore","$routeParams","SharedState",function(a,b,c,d,e){a.hideCustomersList=!0,a.hideIcbcList=!0,a.checkInfoIcbc="查看更多",a.checkInfoCustomers="查看更多",a.id=d.id,document.getElementById("btitle").innerHTML=window.history.length,console.log("a"+history.length),a.AddFavor=function(){console.log("开始收藏"),b.post("http://223.223.177.38:8082/OFSTCUST/cuinfo/findCuMoreById.action ",{t_k:c.get("t_k"),c_no:c.get("c_no"),store_code:a.id,city_code:c.get("city_code")}).success(function(a){0===a.res&&console.log("成功"),1000002===a.res&&console.log("失败"),1000003===a.res&&console.log("缺少参数")})},b.post("http://223.223.177.38:8082/OFSTCUST/cuinfo/findCuMoreById.action ",{t_k:c.get("t_k"),c_no:c.get("c_no"),store_code:a.id,city_code:""}).success(function(b){b={res:0,data:{store_code:"102030411111",store_name:"商户名称",image_url:"http://",image_name:"test",address:"海淀区",dcmt_level:"5",distance:"700",small_type:"川菜/家常菜",people_consumption:"200",praise_count:"3",sentiment_count:"2000",view_count:"11111",tel_phone:"010-999999",is_yd:"1",is_fq:"0",is_jf:"1",is_sk:"0",is_gh:"0",is_tu:"0",is_cx:"0",is_ka:"0",is_free:"1",is_wifi:"0",is_credit_card:"1",start_time:"09:00",end_time:"22:00"}};var c=b.data;a.busiInfo={store_code:c.store_code,store_name:c.store_name,image_url:c.image_url,image_name:c.image_name,address:c.address,people_consumption:c.people_consumption,sentiment_count:c.sentiment_count,praise_count:c.praise_count,view_count:c.view_count,tel_phone:c.tel_phone,start_time:c.start_time,end_time:c.end_time,is_wifi:"0"==c.is_wifi?"_gray":"",is_free:"0"==c.is_free?"_gray":"",is_credit_card:"0"==c.is_credit_card?"_gray":""};var d=[];d[0]="0"==c.is_yd?"none":"yi",d[1]="0"==c.is_fq?"none":"fen",d[2]="0"==c.is_jf?"none":"ji",d[3]="0"==c.is_sk?"none":"shan",d[4]="0"==c.is_gh?"none":"gong",d[5]="0"==c.is_tu?"none":"tuan",d[6]="0"==c.is_cx?"none":"cu",d[7]="0"==c.is_ka?"none":"ka",a.busiInfo.flags=d;for(var e=[],f=0;5>f;f++)f+1<=c.dcmt_level?e[f]={type:"full"}:f-c.dcmt_level<0?e[f]={type:"half"}:e[f]={type:"gray"};a.busiInfo.stars=e,a.flags=d,console.log(a.busiInfo)}),b.post("http://223.223.177.38:8082/OFSTCUST/cuinfo/findCuMoreById.action ",{t_k:c.get("t_k"),c_no:c.get("c_no"),store_code:a.id}).success(function(b){b={res:"0",data:[{pft_code:"11111",image_url:"http://",image_name:"xxx",title:"俏江南望京店",o_price:"150",n_pirce:"99"},{pft_code:"11111",image_url:"http://",image_name:"xxx",title:"俏江南望京店",o_price:"150",n_pirce:"99",buy_count:"10023"},{pft_code:"11111",image_url:"http://",image_name:"xxx",title:"代金券",o_price:"150",n_pirce:"99"}]},a.discounts=b.data}),a.otherStores=function(){b.post("http://223.223.177.38:8082/OFSTCUST/cuinfo/findCuMoreById.action",{t_k:c.get("t_k"),c_no:c.get("c_no"),store_code:a.id,count:10}).success(function(b){b={res:"0",data:[{store_code:"102030411111",store_name:"123",level:"1",image_url:"",district_name:"金融街",distance:"100",small_code:"1",promotions_type:"255",is_yd:"1",is_fq:"0",is_jf:"0",is_sk:"0",is_gh:"0",is_tu:"0",is_cx:"0",is_ka:"0"},{store_code:"102030411111",store_name:"1221213",level:"1.5",image_url:"",district_name:"金融街",distance:"25000",small_code:"22",promotions_type:"127",is_yd:"1",is_fq:"0",is_jf:"0",is_sk:"0",is_gh:"0",is_tu:"0",is_cx:"0",is_ka:"0"}]};for(var c=b.data,d=0;d<c.length;d++){for(var e=[],f=[],g=0;5>g;g++)g+1<=c[d].level?e[g]={type:"full"}:g-c[d].level<0?e[g]={type:"half"}:e[g]={type:"gray"},f[0]="0"==c[d].is_yd?"none":"yi",f[1]="0"==c[d].is_fq?"none":"fen",f[2]="0"==c[d].is_jf?"none":"ji",f[3]="0"==c[d].is_sk?"none":"shan",f[4]="0"==c[d].is_gh?"none":"gong",f[5]="0"==c[d].is_tu?"none":"tuan",f[6]="0"==c[d].is_cx?"none":"cu",f[7]="0"==c[d].is_ka?"none":"ka";c[d].stars=e,c[d].flags=f,c[d].price=c[d].promotions_type}console.log(c),a.otherStores=c})},a.otherStores(),a.getBusiDetail=function(d){b.post("http://223.223.177.38:8082/OFSTCUST/cuinfo/findCuMoreById.action",{t_k:c.get("t_k"),c_no:c.get("c_no"),store_code:a.id}).success(function(b){data={res:"0",data:{store_code:"102030411111",store_info:"商户简介信息.......",store_ts:"商户特色......",start_time:"07:00",end_time:"23:00"}};var c=data.data;console.log(c),a.busiDetail=c})},a.errorReport=function(a){}}]),elife.controller("businessRecommendCtrl",["$scope","SharedState","API",function(a,b,c){c.getMoreRecommandStore({count:20}).then(function(b){a.storeList=b},function(a){console.error("推荐商户页面获取失败："+a)})}]),elife.controller("BusinessSearchResultCtrl",["$scope","SharedState","$routeParams","$cookieStore","$http","API",function(a,b,c,d,e,f){a.keyword=c.keyword||"",a.currentDistrict={},a.currentSmallType={},a.loading=!0,a.isEmpty=!1,a.sideTab2=0,a.selectType=function(b){a.currentType=b},a.filterToggle=function(a){if(0===a)b.turnOff("listFilter");else{var c=b.get("listFilterIndex")||0;a===c?b.toggle("listFilter"):(b.set({listFilterIndex:a}),b.turnOn("listFilter"))}},a.filterByDistrict=function(b){a.currentDistrict=b,a.getList(),a.filterToggle(0)},a.filterByType=function(b){a.currentSmallType=b,a.getList(),a.filterToggle(0)},f.getAllDistrict({}).then(function(b){a.hotCitys=b.top_list,a.citys=b.data,console.log(a.hotCitys),console.log(a.citys),console.log(a.keyword);for(var c=a.hotCitys.length;c--;)a.hotCitys[c].communityName==a.keyword&&(a.currentDistrict.communityName=a.keyword);for(c=a.citys.length;c--;)a.citys[c].districtName==a.keyword&&(a.currentDistrict.districtName=a.keyword)},function(b){console.error("商区获取失败："+b),a.toast("请检查网络设置")}),f.getAllType({}).then(function(b){a.allTypes=b,a.currentType=b[0];for(var c=b.length,d=0;c>d;){a.small_industry_list=b[d].small_industry_list;for(var e=a.small_industry_list.length;e--;)a.small_industry_list[e].small_name==a.keyword&&(a.currentSmallType.small_name=a.keyword);d++}},function(a){console.error("全部分类获取失败："+a)}),a.getList=function(){a.isEmpty=!1,a.loading=!0,para={keyword:a.keyword,t_k:d.get("t_k"),c_no:d.get("c_no"),city_code:d.get("city_code"),longitude:d.get("longitude"),latitude:d.get("latitude")},f.getStore(para).then(function(b){console.log(b),a.list=b,a.loading=!1,void 0===b||0===b.length?a.isEmpty=!0:a.isEmpty=!1},function(b){a.toast("请检查网络状况"),a.loading=!1,a.isEmpty=!0}),f.addHomeSearchHistory(a.keyword)},a.getList()}]),elife.controller("Calculator",["$scope",function(a){a.Minus=function(b){a.num>=b&&(a.num=a.num-1,a.total_price=a.num*a.price)},a.Plus=function(b){a.num<=b&&(a.num=a.num+1,a.total_price=a.num*a.price)},a.Total=function(){return isNaN(a.num)?0:(a.total=(a.num*a.price).toString(),a.total="￥"+a.total+".00",a.total)},a["default"]=function(){isNaN(a.num)&&(a.num=1)}}]),elife.controller("CardOfferListCtrl",["$scope","SharedState","$http","$cookieStore","API",function(a,b,c,d,e){a.typeName="工行卡优惠",a.cardOfferList=[{image_url:"images/restaurant_qjn.jpg",title:"工行卡优惠标题",begin_time:"2015-05-05",count:"6"},{image_url:"images/restaurant_qjn.jpg",title:"工行卡优惠标题",begin_time:"2015-05-05",count:"6"}],a.filterToggle=function(a){if(0===a)b.turnOff("listFilter");else{var c=b.get("listFilterIndex")||0;a===c?b.toggle("listFilter"):(b.set({listFilterIndex:a}),b.turnOn("listFilter"))}},a.sideTab2=0,a.selectType=function(b){a.currentType=b},a.filterByDistrict=function(b){a.currentDistrict=b,a.getList(),a.filterToggle(0)},a.filterByType=function(b){a.currentSmallType=b,a.getList(),a.filterToggle(0)},e.getAllDistrict({}).then(function(b){a.hotCitys=b.top_list,a.citys=b.data},function(a){console.error("商区获取失败："+a)}),e.getAllType({}).then(function(b){a.allTypes=b,a.currentType=b[0]},function(a){console.error("全部分类获取失败："+a)}),a.getList=function(){para={},a.currentType&&(para.large_code=a.currentType.big_code),a.currentSmallType&&(para.small_code=a.currentSmallType.small_code),a.currentDistrict&&(para.district_code=a.currentDistrict.countryCode||a.currentDistrict.districtCode),e.getCardOfferBySearch(para).then(function(b){a.list=b},function(a){console.error("列表获取失败："+a)})},a.getList()}]),elife.controller("CustomersInfoCtrl",["$scope","SharedState","$http","$cookieStore","$routeParams",function(a,b,c,d,e){a.num=1,a.price=85,a.Minus=function(){a.num>=2&&(a.num=a.num-1)},a.Plus=function(){a.num<=99&&(a.num=a.num+1)},a.Total=function(){return isNaN(a.num)?0:(a.total=(a.num*a.price).toString(),a.total="￥"+a.total+".00",a.total)},a["default"]=function(b){isNaN(a.num)&&(a.num=1),b.target.value=a.num},a.submitOrder=function(){1===a.num?location.href="#/discount/customers_succeeded":b.turnOn("submit_order_error_modal")},a.addCustomerFavor=function(){console.log("收藏团购"),c.post("http://223.223.177.38:8082/OFSTCUST/cuinfo/findCuMoreById.action ",{t_k:d.get("t_k"),c_no:d.get("c_no"),t_code:"11"}).success(function(a){0===a.res&&console.log("成功"),1000002===a.res&&console.log("失败"),1000003===a.res&&console.log("缺少参数")})}}]),elife.controller("DiscountCategoriesCtrl",["$scope",function(a){for(a.showList=[],i=0;i<5;i++)a.showList[i]=!1}]),elife.controller("DiscountCommentCtrl",["$scope",function(a){a.isTyping=!1,a.globalStar=0,a.tasteStar=0,a.environmentStar=0,a.serviceStar=0,a.hideAvg=!0,a.des=["差","不满意","一般","满意","非常满意"]}]),elife.controller("DiscountSearchCtrl",["$scope",function(a){}]),elife.controller("ECouponCtrl",["$scope","$http","$cookieStore","SharedState",function(a,b,c,d){a.filterToggle=function(a){if(0===a)d.turnOff("listFilter");else{var b=d.get("listFilterIndex")||0;a===b?d.toggle("listFilter"):(d.set({listFilterIndex:a}),d.turnOn("listFilter"))}},b.post("http://223.223.177.38:8082/OFSTCUST/info/showEleTicket.action",{t_k:c.get("t_k"),c_no:c.get("c_no")}).success(function(b){console.log(b);var c=b.data;console.log(c),a.ECoupons=[];for(var d=0;d<c.length;d++)a.ECoupons[d]={Ec_name:c[d].ec_name,Ec_code:c[d].ec_code,Effect_beginDate:c[d].effect_beginDate.substr(0,10),Effect_endDate:c[d].effect_endDate.substr(0,10),Effect_content:c[d].effect_content,Effect_state:c[d].effect_state}}).error(function(b,c){console.error("获取我的电子券失败："+b),a.toast("请检查网络状况")})}]),elife.controller("ErrorCtrl",["$scope","$routeParams","$cookieStore","$http",function(a,b,c,d){a.id=b.id,a.errorReport=function(b){var e={t_k:c.get("t_k"),c_no:c.get("c_no"),store_code:a.id};e.type=b,"other"==b&&(e.is_close=1),d.post("http://xxxx",e).success(function(){console.log("提交成功"),history.back()}),history.back()},d.post("http://223.223.177.38:8082/OFSTCUST/cuinfo/findCuMoreById.action ",{t_k:c.get("t_k"),c_no:c.get("c_no"),store_code:a.id,city_code:""}).success(function(b){b={res:0,data:{store_code:"102030411111",store_name:"商户名称",image_url:"http://",image_name:"test",address:"海淀区",dcmt_level:"5",distance:"700",small_type:"川菜/家常菜",people_consumption:"200",praise_count:"3",sentiment_count:"2000",view_count:"11111",tel_phone:"010-999999",is_yd:"1",is_fq:"0",is_jf:"1",is_sk:"0",is_gh:"0",is_tu:"0",is_cx:"0",is_ka:"0",is_free:"1",is_wifi:"0",is_credit_card:"1",start_time:"09:00",end_time:"22:00"}};var c=b.data;a.busiInfo={store_code:c.store_code,store_name:c.store_name,address:c.address,small_type:c.small_type,people_consumption:c.people_consumption,sentiment_count:c.sentiment_count,praise_count:c.praise_count,view_count:c.view_count,tel_phone:c.tel_phone},console.log(a.busiInfo)}),a.otherErrorReport=function(a){window.location.href="#/business/index/102030411111"}}]),elife.controller("HomeCategoriesCtrl",["$scope","$http","$rootScope","$cookieStore",function(a,b,c,d){for(a.showList=[],b.post("http://223.223.177.38:8082/OFSTCUST/industry/getAllType.action",{t_k:d.get("t_k"),c_no:d.get("c_no")}).success(function(b){"0"==b.res&&(a.categoryInfo=b.data,console.log(a.categoryInfo),a.big_name1=a.categoryInfo[0].big_name,a.list1=a.categoryInfo[0].small_industry_list,console.log(a.list1))}),i=0;i<5;i++)a.showList[i]=!1;a.setErrorType=function(a,b){c.small_code=a,c.small_name=b,history.back()}}]),elife.controller("CategoryResultCtrl",["$scope","$routeParams","$route","SharedState","API",function(a,b,c,d,e){a.id=b.id,a.name=b.name,a.loading=!0,a.isEmpty=!1,a.sideTab2=0,a.selectType=function(b){a.currentType=b},a.filterToggle=function(a){if(0===a)d.turnOff("listFilter");else{var b=d.get("listFilterIndex")||0;a===b?d.toggle("listFilter"):(d.set({listFilterIndex:a}),d.turnOn("listFilter"))}},a.filterByDistrict=function(b){a.currentDistrict=b,a.getList(),a.filterToggle(0)},a.filterByType=function(b){a.currentSmallType=b,a.getList(),a.filterToggle(0)},e.getAllDistrict({}).then(function(b){a.hotCitys=b.top_list,console.log(a.hotCitys),a.citys=b.data},function(b){a.toast("请检查网络状况"),console.error("商区获取失败："+b)}),e.getAllType({}).then(function(b){a.allTypes=b,a.currentType=b[0]},function(b){a.toast("请检查网络状况"),console.error("全部分类获取失败："+b)}),a.getList=function(){a.loading=!0,a.isEmpty=!1,para={},a.currentType&&(para.large_code=a.currentType.big_code),a.currentSmallType&&(para.small_code=a.currentSmallType.small_code),a.currentDistrict&&(para.district_code=a.currentDistrict.countryCode||a.currentDistrict.districtCode),e.getNearBySearch(para).then(function(b){a.list=b,a.loading=!1,(void 0===b||0===b.length)&&(a.isEmpty=!0)},function(b){a.toast("请检查网络状况"),a.isEmpty=!0,a.loading=!1,console.error("列表获取失败："+b)})},a.getList()}]),elife.controller("IndexCtrl",["$scope","$rootScope","$timeout","$cookieStore","$http","API",function(a,b,c,d,e,f){var g=1e4,h=(new Date).getTime();a.countDown={_start:h,_end:h+1e3*g,hourUpper:0,hour:0,minuteUpper:0,minute:0,secondUpper:0,second:0,_go:function(){var a=(new Date).getTime(),b=(this._end-a)/1e3,c=Math.floor(b/3600);this.hour=Math.floor(c/10),this.hourUpper=c%10;var d=Math.floor((b-3600*c)/60);this.minute=Math.floor(d/10),this.minuteUpper=d%10;var e=Math.floor(b%60);this.second=Math.floor(e/10),this.secondUpper=e%10}},a.location=d.get("city_name");var i=function(){a.countDown._go(),c(i,1e3)};i(),f.getBannerInfo().then(function(b){a.bannerInfo=b,console.log("首页图片"),console.log(a.bannerInfo)},function(b){console.error("宣传图片获取失败"+b),a.toast("请检查网络状况"),a.bannerInfo=[]}),f.getHomeLargeCategory({e_row:3}).then(function(b){console.log("行业大类："),console.log(b),a.largeCategory=b},function(b){a.largeCategory=[],console.error("行业大类获取失败："+b),a.toast("请检查网络状况")}),a.specialOffer=[{store_name:"门店优惠标题",image_url:"images/restaurant_bgps.jpg",preferential_code:"252166254424",o_price:"123",n_price:"100"},{store_name:"门店优惠标题",image_url:"images/restaurant_bgps.jpg",preferential_code:"252166254424",o_price:"123",n_price:"100"},{store_name:"门店优惠标题",image_url:"images/restaurant_bgps.jpg",preferential_code:"252166254424",o_price:"123",n_price:"100"}],f.getHomeRecommandStore({count:5}).then(function(b){a.recommandStore=b},function(b){a.recommandStore=[{store_code:"1111111",store_name:"门店名称",image_url:"images/restaurant_jdx.jpg",title:"超值自助餐"},{store_code:"1111111",store_name:"门店名称",image_url:"images/restaurant_jdx.jpg",title:"超值自助餐"}]}),a.guessLike=[{cis_num:"102030411111",mer_name:"商户名称",image_url:"images/restaurant_qjn.jpg",address:"海淀区",dcmt_level:"4",distance:"700",small_type:"川菜/家常菜",price:"200",is_yd:"1",is_fq:"0",is_jf:"1",is_sk:"0",is_gh:"0",is_tu:"0",is_cx:"0",is_ka:"0"},{cis_num:"102030411111",mer_name:"商户名称",image_url:"images/restaurant_qjn.jpg",address:"海淀区",dcmt_level:3,distance:"700",small_type:"川菜/家常菜",price:"200",is_yd:"1",is_fq:"0",is_jf:"1",is_sk:"0",is_gh:"0",is_tu:"0",is_cx:"0",is_ka:"0"}],a.yidaiName="逸贷(分期)商户",a.jifenName="积分消费商户",a.get_location=function(){var a=location_callback,b={key:"getGPS",callBack:a};ICBCUtil.nativeGetConfig(b)},a.close_client=function(){ICBCUtil.returnBack()}}]),elife.controller("IndexDiscountCtrl",["$scope","$http","$cookieStore","$routeParams",function(a,b,c,d){ICBCUtil.isElife()&&(document.getElementById("foot").style.display="none",
document.getElementById("close_icon").style.display="none",document.getElementById("aa").innerHTML=aa),a.test=function(){ICBCUtil.iOSExcuteNativeMethod("NATIVE://aaadd")},a.addBusinessFavor=function(){console.log("收藏商户"),b.post("http://192.168.2.60:8080/OFSTCUST/cuinfo/findCuMoreById.action ",{t_k:c.get("t_k"),c_no:c.get("c_no"),s_code:"11",pft_code:c.get("city_code")}).success(function(a){0===a.res&&console.log("成功"),1000002===a.res&&console.log("失败"),1000003===a.res&&console.log("缺少参数")})},a.addBankFavor=function(){console.log("收藏银行"),b.post("http://192.168.2.60:8080/OFSTCUST/cuinfo/findCuMoreById.action ",{t_k:c.get("t_k"),c_no:c.get("c_no"),b_code:"11"}).success(function(a){0===a.res&&console.log("成功"),1000002===a.res&&console.log("失败"),1000003===a.res&&console.log("缺少参数")})}}]),elife.controller("JifenBusinessCtrl",["$scope","$routeParams","SharedState","$http","$cookieStore","API",function(a,b,c,d,e,f){a.name=b.name,a.loading=!0,a.isEmpty=!1,a.sideTab2=0,a.selectType=function(b){a.currentType=b},a.filterToggle=function(a){if(0===a)c.turnOff("listFilter");else{var b=c.get("listFilterIndex")||0;a===b?c.toggle("listFilter"):(c.set({listFilterIndex:a}),c.turnOn("listFilter"))}},a.filterByDistrict=function(b){a.currentDistrict=b,a.getList(),a.filterToggle(0)},a.filterByType=function(b){a.currentSmallType=b,a.getList(),a.filterToggle(0)},a.filterBySort=function(b){a.currentSortType=b,a.getList(),a.filterToggle(0)},f.getAllDistrict({}).then(function(b){a.hotCitys=b.top_list,a.citys=b.data},function(a){console.error("商区获取失败："+a)}),f.getAllType({}).then(function(b){a.allTypes=b,a.currentType=b[0]},function(a){console.error("全部分类获取失败："+a)}),a.getList=function(){a.loading=!0,para={},a.currentType&&(para.large_code=a.currentType.big_code),a.currentSmallType&&(para.small_code=a.currentSmallType.small_code),a.currentDistrict&&(para.district_code=a.currentDistrict.countryCode||a.currentDistrict.districtCode),a.currentSortType&&(para.sort=a.currentSortType),para.type="JF",para.latitude="",para.longitude="",f.getJifenBySearch(para).then(function(b){for(var c=b,d=0;d<c.length;d++)c[d].discount_role=f.resolveDiscountRole(c[d].discount_role);a.storeList=c,(void 0===c||0===c.length)&&(a.isEmpty=!0),a.loading=!1},function(b){a.toast("请检查网络状况"),a.loading=!1,a.isEmpty=!0})},a.getList()}]),elife.controller("LocatorCtrl",["$scope","$http","API","$anchorScroll","$cookieStore","$timeout","_serarchCity",function(a,b,c,d,e,f,g){for(var h=document.getElementById("LocatorScrollableContent"),i=[],j=0,k=26;k>j;j++)i.push(String.fromCharCode(65+j));a.getAlphas=function(){return i},a.locate=function(a){var b=document.getElementById(a);if(h&&b){var c=b.offsetTop-h.offsetTop;h.scrollTop=c}},a.searchPaneShow=!1,a.toggleearchPane=function(b){a.searchPaneShow=b||!1},c.getHotSearchCity({}).then(function(b){a.hotCity=b},function(a){$rootScope.toast("请检查网络状况")}),c.getCity({}).then(function(b){a.areaInfo=b[0];var c=b;a.allCity=c},function(a){}),a.doSubmitAddress=function(a){c.changePersonalInfo({t_k:e.get("t_k"),c_no:e.get("c_no"),req_type:"address",n_address:a}).then(function(){history.back()},function(){$rootScope.toast("地址修改失败，请检查网络状况")})},a.doChooseAddress=function(a,c){b.post("http://223.223.177.38:8082/OFSTCUST/cuinfo/updateCuinfo.action",{t_k:e.get("t_k"),c_no:e.get("c_no"),req_type:"address",c_code:a}).success(function(b){console.log(b),"0"==b.res&&(console.log("修改成功！"),e.put("city_code",a),e.put("city_name",c),history.back())})};var l;a.$watch("cityKeyword",function(b){b&&(l&&f.cancel(l),l=f(function(){g.success(function(b){console.log(b),a.searchResultList=b.data})},500))})}]),elife.controller("MyCommentCtrl",["$scope","SharedState",function(a,b){a.commentList=[{business:"海底捞",star:4.5,time:"2015-03-22",content:"不错不错，味道好极了！",more:"菜很好吃，服务非常赞。还有双重优惠，非常划算。不过人还是不少，如果没有提前预定，需要排队，建议提前约好时间，预留座。菜很好吃，服务非常赞。其务非常务非常好。"},{business:"海底捞",star:4.5,time:"2015-03-22",content:"不错不错，味道好极了！"},{business:"海底捞",star:4.5,time:"2015-03-22",content:"不错不错，味道好极了！"}],a.isEditing=!1;var c=[];a.edit=function(){a.isEditing?a.isEditing=!1:(a.isEditing=!0,c=[])},a.select=function(a){var b=c.indexOf(a);-1===b?c.push(a):c.splice(b,1)},a.isSelect=function(a){var b=c.indexOf(a);return-1!=b},a.cancel=function(){a.isEditing=!1,c=[]},a.preDelete=function(){b.turnOn(c&&c.length>0?"comment_del_modal":"comment_error_modal")},a["delete"]=function(){for(var b=0,d=c.length;d>b;b++){var e=a.commentList.indexOf(c[b]);-1!=e&&a.commentList.splice(e,1)}a.isEditing=!1}}]),elife.controller("MyCommentDetailCtrl",["$scope","SharedState","$routeParams",function(a,b,c){var d=(c.id,{business:"海底捞",star:4.5,starEnv:3,starSrvs:2,starTaste:4,time:"2015-03-22",content:"不错不错，味道好极了！菜很好吃，服务非常赞。还有双重优惠，非常划算。不过人还是不少，如果没有提前预定，需要排队，建议提前约好时间，预留座。菜很好吃，服务非常赞。其务非常务非常好！"});a.des=["差","不满意","一般","满意","非常满意"],a.comment=d}]),elife.controller("MyCustomersCtrl",["$scope",function(a){a.active=1,a.send_check=-1,a.drawbackCheck=[!1,!1],a.num=1,a.price=17,a.Minus=function(){a.num>=2&&(a.num=a.num-1)},a.Plus=function(){a.num<=99&&(a.num=a.num+1)},a.Total=function(){return isNaN(a.num)?0:(a.total=(a.num*a.price).toString(),a.total="￥"+a.total+".00",a.total)},a["default"]=function(b){isNaN(a.num)&&(a.num=1),b.target.value=a.num}}]),elife.controller("MyFavoritesCtrl",["$scope","$http","$cookieStore","SharedState",function(a,b,c,d){for(a.favor_delete=!1,a.discount_delete=!1,a.favor_select=[],a.discount_select=[],a.delete_btn=!1,a.showDelete=!0,i=0;i<5;i++)a.favor_select[i]=!1,a.discount_select[i]=!1;a.filterToggle=function(a){if(0===a)d.turnOff("listFilter");else{var b=d.get("listFilterIndex")||0;a===b?d.toggle("listFilter"):(d.set({listFilterIndex:a}),d.turnOn("listFilter"))}},a.openModal=function(){d.turnOn(a.showDelete?angular.element(document.getElementsByClassName("delete_item")).length?"favor_del_modal":"favor_del_error_modal":angular.element(document.getElementsByClassName("delete_discount_item")).length?"favor_del_modal":"favor_del_error_modal")},a.deleteFavorCancel=function(){a.favor_delete=!1},a.deleteDiscountCancel=function(){a.discount_delete=!1},a["delete"]=function(){a.showDelete?angular.element(document.getElementsByClassName("delete_item")).remove():angular.element(document.getElementsByClassName("delete_discount_item")).remove()},a.deleteFavorIni=function(){for(a.favor_delete=!0,i=0;i<5;i++)a.favor_select[i]=!1},a.deleteDiscountIni=function(){for(a.discount_delete=!0,i=0;i<5;i++)a.discount_select[i]=!1},a.getFavBusiness=function(d){b.post("http://223.223.177.38:8082/OFSTCUST/cuinfo/findCuMoreById.action",{t_k:c.get("t_k"),c_no:c.get("c_no"),keyword:d}).success(function(b){b={res:"0",data:[{cis_num:"102030411111",mer_name:"商户名称1",image_url:"images/restaurant_qjn.jpg",address:"海淀区",dcmt_level:"3.5",distance:"700",small_type:"川菜/家常菜",price:"300",is_yd:"1",is_fq:"0",is_jf:"0",is_sk:"0",is_gh:"0",is_tu:"0",is_cx:"0",is_ka:"0"},{cis_num:"102030411111",mer_name:"商户名称2",image_url:"images/restaurant_qjn.jpg",address:"海淀区",dcmt_level:"4",distance:"700",small_type:"川菜/家常菜",price:"201",is_yd:"1",is_fq:"0",is_jf:"0",is_sk:"0",is_gh:"0",is_tu:"0",is_cx:"0",is_ka:"0"}]};for(var c=b.data,d=0;d<c.length;d++){for(var e=[],f=[],g=0;5>g;g++)g+1<=c[d].dcmt_level?e[g]={type:"full"}:g-c[d].dcmt_level<0?e[g]={type:"half"}:e[g]={type:"gray"};f[0]="0"==c[d].is_yd?"none":"yi",f[1]="0"==c[d].is_fq?"none":"fen",f[2]="0"==c[d].is_jf?"none":"ji",f[3]="0"==c[d].is_sk?"none":"shan",f[4]="0"==c[d].is_gh?"none":"gong",f[5]="0"==c[d].is_tu?"none":"tuan",f[6]="0"==c[d].is_cx?"none":"cu",f[7]="0"==c[d].is_ka?"none":"ka",c[d].stars=e,c[d].flags=f}console.log(c),a.FavBusinesses=c})},a.getFavBusinessByConditions=function(d){b.post("http://223.223.177.38:8082/OFSTCUST/cuinfo/findCuMoreById.action",{t_k:c.get("t_k"),c_no:c.get("c_no"),small_code:"",district_code:"",sort_code:""}).success(function(b){b={res:"0",data:[{cis_num:"102030411111",mer_name:"商户名称1",image_url:"images/restaurant_qjn.jpg",address:"海淀区",dcmt_level:"3.5",distance:"700",small_type:"川菜/家常菜",price:"300",isflag:"true",is_yd:"1",is_fq:"0",is_jf:"0",is_sk:"0",is_gh:"0",is_tu:"0",is_cx:"0",is_ka:"0"},{cis_num:"102030411111",mer_name:"商户名称2",image_url:"images/restaurant_qjn.jpg",address:"海淀区",dcmt_level:"4",distance:"700",small_type:"川菜/家常菜",price:"201",isflag:"false",is_yd:"1",is_fq:"0",is_jf:"0",is_sk:"0",is_gh:"0",is_tu:"0",is_cx:"0",is_ka:"0"}]};for(var c=b.data,d=0;d<c.length;d++){for(var e=[],f=[],g=0;5>g;g++)g+1<=c[d].dcmt_level?e[g]={type:"full"}:g-c[d].dcmt_level<0?e[g]={type:"half"}:e[g]={type:"gray"},f[0]="0"==c[d].is_yd?"none":"yi",f[1]="0"==c[d].is_fq?"none":"fen",f[2]="0"==c[d].is_jf?"none":"ji",f[3]="0"==c[d].is_sk?"none":"shan",f[4]="0"==c[d].is_gh?"none":"gong",f[5]="0"==c[d].is_tu?"none":"tuan",f[6]="0"==c[d].is_cx?"none":"cu",f[7]="0"==c[d].is_ka?"none":"ka";c[d].stars=e,c[d].flags=f}console.log(c),a.FavBusinesses=c})},a.getFavDiscount=function(d){b.post("http://223.223.177.38:8082/OFSTCUST/cuinfo/findCuMoreById.action",{t_k:c.get("t_k"),c_no:c.get("c_no")}).success(function(b){b={res:"0",data:[{pft_code:"11111",image_url:"http://",image_name:"图片名称提示",title:"商户优惠标题",o_price:"200",n_pirce:"120"},{pft_code:"11111",image_url:"http://",image_name:"图片名称提示",title:"商户优惠标题",o_price:"200",n_pirce:"120"},{pft_code:"11111",image_url:"http://",title:"团购标题",begin_time:"2015-05-05",end_time:"2015-05-08",borwse:"6"},{pft_code:"11111",image_url:"http://",title:"团购标题",begin_time:"2015-05-05",end_time:"2015-05-08",borwse:"6"},{pft_code:"11111",image_url:"http://",title:"银行优惠标题",count:"6"},{pft_code:"11111",image_url:"http://",title:"团购标题",begin_time:"2015-05-05",count:"6"}]};var c=b.data;console.log(c),a.FavDiscounts=c})},a.getFavBusiness("")}]),elife.controller("OfferSearchResultCtrl",["$scope","SharedState","API",function(a,b,c){a.sideTab2=0,a.selectType=function(b){a.currentType=b},a.filterToggle=function(a){if(0===a)b.turnOff("listFilter");else{var c=b.get("listFilterIndex")||0;a===c?b.toggle("listFilter"):(b.set({listFilterIndex:a}),b.turnOn("listFilter"))}},a.filterByDistrict=function(b){a.currentDistrict=b,a.getList(),a.filterToggle(0)},a.filterByType=function(b){a.currentSmallType=b,a.getList(),a.filterToggle(0)},c.getAllDistrict({}).then(function(b){a.hotCitys=b.top_list,a.citys=b.data},function(a){console.error("商区获取失败："+a)}),c.getAllType({}).then(function(b){a.allTypes=b,a.currentType=b[0]},function(a){console.error("全部分类获取失败："+a)}),a.getList=function(){para={},a.offerList=[{store_code:"门店名称",store_name:"",distance:"700",store_list:[{image_url:"images/restaurant_qjn.jpg",image_name:"xxx",title:"俏江南望京店",o_price:"150",n_price:"99",buy_count:"10023"},{image_url:"images/restaurant_qjn.jpg",image_name:"xxx",title:"俏江南望京店",o_price:"150",n_price:"99",buy_count:"10023"},{image_url:"images/restaurant_qjn.jpg",image_name:"xxx",title:"俏江南望京店",o_price:"150",n_price:"99",buy_count:"10023"}]},{store_code:"门店名称",store_name:"",distance:"700",store_list:[{image_url:"images/restaurant_qjn.jpg",image_name:"xxx",title:"俏江南望京店",o_price:"150",n_price:"99",buy_count:"10023"},{image_url:"images/restaurant_qjn.jpg",image_name:"xxx",title:"俏江南望京店",o_price:"150",n_price:"99",buy_count:"10023"}]}]},a.getList()}]),elife.controller("PersonalCtrl",["$scope","$http","$cookieStore",function(a,b,c){a.check=function(){var b=document.getElementById("trade_return_content").value.length;b>999&&(a.content=a.content.substring(0,999))},a.e_coupon_url="#/personal/e_coupon",b.post("http://223.223.177.38:8082/OFSTCUST/info/showEleTicket.action",{t_k:c.get("t_k"),c_no:c.get("c_no")}).success(function(b){console.log(b);var c=b.data;angular.isUndefined(c)&&(a.e_coupon_url="#/personal/e_coupon_blank")})}]),elife.controller("PersonalInfoCtrl",["$rootScope","SharedState","$scope","$http","$cookieStore","API",function(a,b,c,d,e,f){c.getGender=function(){return"男"===c.personalInfo.gender?0:1},c.SetGender=function(a){return a==c.getGender()?!1:void d.post("http://223.223.177.38:8082/OFSTCUST/cuinfo/updateCuinfo.action",{t_k:e.get("t_k"),c_no:e.get("c_no"),req_type:"sex",n_sex:a}).success(function(b){"0"==b.res&&(0===a?c.personalInfo.gender="男":c.personalInfo.gender="女")})},d.post("http://223.223.177.38:8082/OFSTCUST/cuinfo/findCuMoreById.action",{t_k:e.get("t_k"),c_no:e.get("c_no")}).success(function(a){var b=a.data;console.log(a),c.personalInfo={nickname:b.nickName,gender:"0"==b.sex?"男":"女",phone:b.phone,address:b.address,headuri:b.headuri},c.new_nickname=b.nickName,c.imageTmp=c.personalInfo.headuri,c.defaultImg="http://127.0.0.1:8080/dist/images/avatar.png",c.personalInfo.headuri=c.defaultImg,d.get("$scope.personalInfo.headuri").success(function(a){c.personalInfo.headuri=imageTmp})}),c.doSubmitNickname=function(){return c.nickname_error_reg=/[^\u4E00-\u9FA5\w\b_]{1}/,c.nickName_error=0,""===c.new_nickname||void 0===c.new_nickname?(c.nickName_error=1,c.postmsg="昵称不允许为空！",a.Ui.turnOn("modify_success_modal"),!1):c.nickname_error_reg.test(c.new_nickname)?(c.nickName_error=1,a.toast("昵称格式错误，昵称只能使用24个字符以内的字母，数字，中文，下划线"),!1):c.new_nickname.length>24?(c.nickName_error=1,a.toast("昵称修改失败，昵称长度不符合"),!1):(a.toast("正在修改昵称..."),void f.changePersonalInfo({t_k:e.get("t_k"),c_no:e.get("c_no"),req_type:"nick",n_nikename:c.new_nickname}).then(function(a){history.back()},function(b){a.toast("昵称修改失败，请检查网络状况")}))},c.doDeleteNickname=function(){c.new_nickname=""},c.backToPersonalInfo=function(){""===c.new_nickname||void 0===c.new_nickname||1==c.nickName_error?a.Ui.turnOff("modify_success_modal"):(a.Ui.turnOff("modify_success_modal"),history.back())}}]),elife.controller("ReviewAlbumCtrl",["$scope",function(a){}]),elife.controller("ReviewCommentCtrl",["$scope",function(a){a.isTyping=!1,a.globalStar=0,a.tasteStar=0,a.environmentStar=0,a.serviceStar=0,a.des=["差","不满意","一般","满意","非常满意"],a.des2=["差","一般","好","很好","非常好"]}]),elife.controller("ReviewIndexCtrl",["$scope","SharedState",function(a,b){a.showText=-1,a.active_nav=-1,a.showModal=!1,a.showModal=!1,a.filterToggle=function(a){if(0===a)b.turnOff("listFilter");else{var c=b.get("listFilterIndex")||0;a===c?b.toggle("listFilter"):(b.set({listFilterIndex:a}),b.turnOn("listFilter"))}},a.GetText=function(b){a.showText==b?a.showText=-1:a.showText=b}}]),elife.controller("PhotoAddedCtrl",["$scope",function(a){}]),elife.controller("PhotoEditCtrl",["$scope",function(a){a.rotate=0,a.doRotate=function(){a.rotate=(a.rotate+1)%4},a.doDelete=function(){window.location.href="#/review/photo_added"},a.types=[{name:"菜品"},{name:"价目表"},{name:"环境"},{name:"饮品"}],a.currentType=a.types[0],a.selectType=function(b){a.currentType=b}}]),elife.controller("IndexSearchCtrl",["$scope","$rootScope","API","$cookieStore",function(a,b,c,d){a.showHistory=!0,a.close_icon=!0,a.searchValue="",a.keypress=function(b){13==b.keyCode&&a.searchHeaderValue&&(window.location.hash="/home/search_result/"+a.searchHeaderValue)},c.getHotSearchCity({}).then(function(b){console.log(b),a.hotKeywords=b},function(a){console.error("热门城市获取失败："+a)}),a.history=c.getHomeSearchHistory(),a.clearHistory=function(){c.clearHomeSearchHistroy(),a.history=[]}}]),elife.controller("SearchFilterCtrl",["$scope",function(a){a.isRight=!0,a.isSlide=!0,a.switch_btn=!1,a.check_icbc=!0,a.check_discount=!0,a.check_reserve=!0,a.map_toggle=function(){a.switch_btn===!0?(a.switch_btn=!1,a.isRight=!1,a.isSlide=!1):(a.switch_btn=!0,a.isRight=!0,a.isSlide=!0)},a.check_toggle_all=function(){a.check=a.check_reserve&&a.check_icbc&&a.check_discount,a.check===!0?(a.check_icbc=!1,a.check_discount=!1,a.check_reserve=!1):(a.check_icbc=!0,a.check_discount=!0,a.check_reserve=!0)}}]).controller("Ctrl",["$scope",function(a){a.slider={left:{value:100},middle:{value:200},right:{value:700}}}]),elife.controller("specialOfferCtrl",["$scope","$timeout","$cookieStore","$http","API",function(a,b,c,d,e){a.merchantsList=[{pft_code:"111111",image_url:"",title:"商户优惠标题",pft_type:"满2000减500",buss_area_code:"110100",buss_area_name:"海淀区",small_code:"11111",small_name:"家常菜",view_count:"17",distance:"12"},{pft_code:"111111",image_url:"",title:"商户优惠标题",pft_type:"满2000减500",buss_area_code:"110100",buss_area_name:"海淀区",small_code:"11111",small_name:"家常菜",view_count:"17",distance:"12"}],a.groupList=[{group_code:"111111",group_image_url:"",group_title:"团购优惠标题",group_pft:"代金券",old_price:"200",n_price:"1",buy_count:"2000",distance:"700"},{group_code:"111111",group_image_url:"",group_title:"团购优惠标题",group_pft:"代金券",old_price:"200",n_price:"1",buy_count:"2000",distance:"700"}],a.bankList=[{pft_code:"22222",image_url:"",title:"工行优惠标题1",pft_type:"闪酷卡消费",o_price:"300",n_price:"200",view_count:"2000",distance:"800"},{pft_code:"22222",image_url:"",title:"工行优惠标题1",pft_type:"闪酷卡消费",o_price:"300",n_price:"200",view_count:"2000",distance:"800"}]}]),elife.controller("TestCtrl",["$scope","$http",function(a,b){a.aa="11",b({method:"post",url:"http://115.28.109.25/h5_json/home/banner.php",data:a.aa,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(b,c,d,e){b.success&&(a.img=b,console.log("aaa"),console.log(b))})}]),elife.controller("YidaiBusinessCtrl",["$scope","$routeParams","SharedState","$http","$cookieStore","API",function(a,b,c,d,e,f){a.name=b.name,a.loading=!0,a.isEmpty=!1,a.sideTab2=0,a.selectType=function(b){a.currentType=b},a.filterToggle=function(a){if(0===a)c.turnOff("listFilter");else{var b=c.get("listFilterIndex")||0;a===b?c.toggle("listFilter"):(c.set({listFilterIndex:a}),c.turnOn("listFilter"))}},a.filterByDistrict=function(b){a.currentDistrict=b,a.getList(),a.filterToggle(0)},a.filterByType=function(b){a.currentSmallType=b,a.getList(),a.filterToggle(0)},a.filterBySort=function(b){a.currentSortType=b,a.getList(),a.filterToggle(0)},f.getAllDistrict({}).then(function(b){a.hotCitys=b.top_list,a.citys=b.data},function(a){console.error("商区获取失败："+a)}),f.getAllType({}).then(function(b){a.allTypes=b,a.currentType=b[0]},function(a){console.error("全部分类获取失败："+a)}),a.getList=function(){a.loading=!0,para={},a.currentType&&(para.large_code=a.currentType.big_code),a.currentSmallType&&(para.small_code=a.currentSmallType.small_code),a.currentDistrict&&(para.district_code=a.currentDistrict.countryCode||a.currentDistrict.districtCode),a.currentSortType&&(para.sort=a.currentSortType),a.sRow?para.s_row=a.sRow:para.s_row=1,a.latitude?para.latitude=a.latitude:para.latitude="106.66566666",a.longitude?para.longitude=a.longitude:para.longitude="39.6656666",para.type="YD",f.getYidaiBySearch(para).then(function(b){var c=b;console.log(b);for(var d=0;d<c.length;d++){c[d].discount_role=f.resolveDiscountRole(c[d].discount_role);for(var e=[],g=0;5>g;g++)g+1<=c[d].level?e[g]={type:"full"}:g-c[d].level<0?e[g]={type:"half"}:e[g]={type:"gray"};c[d].stars=e}a.storeList=c,(void 0===c||0===c.length)&&(a.isEmpty=!0),a.loading=!1},function(b){a.toast("请检查网络状况"),a.loading=!1,a.isEmpty=!0})},a.getList()}]);